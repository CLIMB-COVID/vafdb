# `vafdb`

## Generating data
```
$ cat metadata.tsv
sample_id	site	bam_path	collection_date
71900E91F7	site1	/path/to/file.bam	2022-10-2
5523DEB355	site6	/path/to/file.bam	2022-9-3
FE3B496871	site2	/path/to/file.bam	2022-5-8
E2A89A963D	site0	/path/to/file.bam	2022-6-5
99508919E2	site1	/path/to/file.bam	2022-10-1
...
```
```
$ vafdb tsv-create metadata.tsv
<[200] OK>
{
    "sample_id": "71900E91F7",
    "task_id": "f13e7d1b-b4f6-40fd-890f-b100ca5b27ee"
}
<[200] OK>
{
    "sample_id": "5523DEB355",
    "task_id": "ed9ba54b-e1a6-4613-b8f9-12a295544943"
}
<[200] OK>
{
    "sample_id": "FE3B496871",
    "task_id": "a77bbf24-f243-498f-938b-d8c8db7ba3ab"
}
<[200] OK>
{
    "sample_id": "E2A89A963D",
    "task_id": "851bf18c-53e6-4f47-90be-191f0d8aa976"
}
<[200] OK>
{
    "sample_id": "99508919E2",
    "task_id": "88aa7765-847d-437c-abe1-744114577ebb"
}
...
```

## Retrieving data
```python
# script.py

from vafdbclient import Client, Field, utils

# Initialise client
client = Client()

# Send a query to the database
result = client.query(
    Field(coverage__gt=100)
    & Field(collection_date__range=["2022-01-01", "2022-01-05"])
    & (Field(site="site1") | Field(site="site2"))
    & Field(entropy__gt=0.4)
    & Field(pc_ds__lt=5)
)

# Create a pandas dataframe from the result
df = utils.pandafy(result)

print(df.to_csv(index=False, sep="\t"), end="")
```
```
$ python script.py
sample_id       reference       position        coverage        num_a   num_c   num_g   num_t   num_ds  pc_a    pc_c    pc_g    pc_t    pc_ds   entropy secondary_entropy       site    bam_path        collection_date       published_date  num_reads       num_vafs        mean_coverage   mean_entropy    references
DD6630363B      MN908947.3      78      162     1       2       25      129     5       0.617   1.235   15.432  79.63   3.086   0.412   0.557   site2   /path/to/file.bam 2022-01-03      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
DD6630363B      MN908947.3      2198    1317    278     1       990     14      34      21.109  0.076   75.171  1.063   2.582   0.429   0.379   site2   /path/to/file.bam 2022-01-03      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
DD6630363B      MN908947.3      5736    1112    25      819     4       224     40      2.248   73.651  0.36    20.144  3.597   0.48    0.538   site2   /path/to/file.bam 2022-01-03      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
DD6630363B      MN908947.3      6078    498     6       355     0       127     10      1.205   71.285  0.0     25.502  2.008   0.448   0.306   site2   /path/to/file.bam 2022-01-03      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
DD6630363B      MN908947.3      10177   295     24      2       70      192     7       8.136   0.678   23.729  65.085  2.373   0.589   0.621   site2   /path/to/file.bam 2022-01-03      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
DD6630363B      MN908947.3      13476   1362    24      1079    7       199     53      1.762   79.222  0.514   14.611  3.891   0.429   0.622   site2   /path/to/file.bam 2022-01-03      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
DD6630363B      MN908947.3      19563   1252    109     13      1001    80      49      8.706   1.038   79.952  6.39    3.914   0.461   0.865   site2   /path/to/file.bam 2022-01-03      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
DD6630363B      MN908947.3      24057   693     96      8       562     9       18      13.853  1.154   81.097  1.299   2.597   0.402   0.617   site2   /path/to/file.bam 2022-01-03      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
DD6630363B      MN908947.3      24314   143     37      2       103     0       1       25.874  1.399   72.028  0.0     0.699   0.423   0.227   site2   /path/to/file.bam 2022-01-03      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
DD6630363B      MN908947.3      28915   5691    3150    2441    13      51      36      55.351  42.892  0.228   0.896   0.633   0.484   0.147   site2   /path/to/file.bam 2022-01-03      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
DD6630363B      MN908947.3      28916   5687    52      27      3260    2247    101     0.914   0.475   57.324  39.511  1.776   0.513   0.242   site2   /path/to/file.bam 2022-01-03      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
4428FC6352      MN908947.3      78      162     1       2       25      129     5       0.617   1.235   15.432  79.63   3.086   0.412   0.557   site1   /path/to/file.bam 2022-01-05      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
4428FC6352      MN908947.3      2198    1317    278     1       990     14      34      21.109  0.076   75.171  1.063   2.582   0.429   0.379   site1   /path/to/file.bam 2022-01-05      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
4428FC6352      MN908947.3      5736    1112    25      819     4       224     40      2.248   73.651  0.36    20.144  3.597   0.48    0.538   site1   /path/to/file.bam 2022-01-05      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
4428FC6352      MN908947.3      6078    498     6       355     0       127     10      1.205   71.285  0.0     25.502  2.008   0.448   0.306   site1   /path/to/file.bam 2022-01-05      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
4428FC6352      MN908947.3      10177   295     24      2       70      192     7       8.136   0.678   23.729  65.085  2.373   0.589   0.621   site1   /path/to/file.bam 2022-01-05      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
4428FC6352      MN908947.3      13476   1362    24      1079    7       199     53      1.762   79.222  0.514   14.611  3.891   0.429   0.622   site1   /path/to/file.bam 2022-01-05      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
4428FC6352      MN908947.3      19563   1252    109     13      1001    80      49      8.706   1.038   79.952  6.39    3.914   0.461   0.865   site1   /path/to/file.bam 2022-01-05      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
4428FC6352      MN908947.3      24057   693     96      8       562     9       18      13.853  1.154   81.097  1.299   2.597   0.402   0.617   site1   /path/to/file.bam 2022-01-05      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
4428FC6352      MN908947.3      24314   143     37      2       103     0       1       25.874  1.399   72.028  0.0     0.699   0.423   0.227   site1   /path/to/file.bam 2022-01-05      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
4428FC6352      MN908947.3      28915   5691    3150    2441    13      51      36      55.351  42.892  0.228   0.896   0.633   0.484   0.147   site1   /path/to/file.bam 2022-01-05      2022-11-23      123901  29903   1649.805        0.116   MN908947.3
4428FC6352      MN908947.3      28916   5687    52      27      3260    2247    101     0.914   0.475   57.324  39.511  1.776   0.513   0.242   site1   /path/to/file.bam 2022-01-05      2022-11-23      123901  29903   1649.805        0.116   MN908947.3

```